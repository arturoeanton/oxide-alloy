// crates/oxidz80/src/cycles.rs

pub const OP_NORMAL: [u32; 256] = [
    4, 10, 7, 6, 4, 4, 7, 4,  4, 11, 7, 6, 4, 4, 7, 4,  // 00-0F
    13,10, 7, 6, 4, 4, 7, 4,  12,11, 7, 6, 4, 4, 7, 4,  // 10-1F
    12,10, 16,6, 4, 4, 7, 4,  12,11, 16,6, 4, 4, 7, 4,  // 20-2F
    12,10, 13,6, 11,11,10,4,  12,11, 13,6, 4, 4, 7, 4,  // 30-3F
    4, 4, 4, 4, 4, 4, 7, 4,   4, 4, 4, 4, 4, 4, 7, 4,   // 40-4F
    4, 4, 4, 4, 4, 4, 7, 4,   4, 4, 4, 4, 4, 4, 7, 4,   // 50-5F
    4, 4, 4, 4, 4, 4, 7, 4,   4, 4, 4, 4, 4, 4, 7, 4,   // 60-6F
    7, 7, 7, 7, 7, 7, 4, 7,   4, 4, 4, 4, 4, 4, 7, 4,   // 70-7F
    4, 4, 4, 4, 4, 4, 7, 4,   4, 4, 4, 4, 4, 4, 7, 4,   // 80-8F
    4, 4, 4, 4, 4, 4, 7, 4,   4, 4, 4, 4, 4, 4, 7, 4,   // 90-9F
    4, 4, 4, 4, 4, 4, 7, 4,   4, 4, 4, 4, 4, 4, 7, 4,   // A0-AF
    4, 4, 4, 4, 4, 4, 7, 4,   4, 4, 4, 4, 4, 4, 7, 4,   // B0-BF
    11,10,12,10,17,11,7, 11,  11,10,12,0, 17,17,7, 11,  // C0-CF
    11,10,12,11,17,11,7, 11,  11,10,12,11,17,0, 7, 11,  // D0-DF
    11,10,12,19,17,11,7, 11,  11,4, 12,4, 17,0, 7, 11,  // E0-EF
    11,10,12,4, 17,11,7, 11,  11,6, 12,4, 17,0, 7, 11,  // F0-FF
];

pub const OP_ED: [u32; 256] = [
    0, 0, 0, 0, 0, 0, 0, 0,  0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0,  0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0,  0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0,  0, 0, 0, 0, 0, 0, 0, 0,
    12,12,15,20,8, 14,8, 9,  12,12,15,20,8, 14,8, 9,  // 40-4F
    12,12,15,20,8, 14,8, 9,  12,12,15,20,8, 14,8, 9,  // 50-5F
    12,12,15,20,8, 14,8, 18, 12,12,15,20,8, 14,8, 18, // 60-6F
    12,12,15,20,8, 14,8, 0,  12,12,15,20,8, 14,8, 0,  // 70-7F
    0, 0, 0, 0, 0, 0, 0, 0,  0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0,  0, 0, 0, 0, 0, 0, 0, 0,
    16,16,16,16,0, 0, 0, 0,  16,16,16,16,0, 0, 0, 0,  // A0-AF
    21,21,21,21,0, 0, 0, 0,  21,21,21,21,0, 0, 0, 0,  // B0-BF
    0, 0, 0, 0, 0, 0, 0, 0,  0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0,  0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0,  0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0,  0, 0, 0, 0, 0, 0, 0, 0,
];

pub fn get_normal_cycles(opcode: u8, taken: bool) -> u32 {
    let mut cycles = OP_NORMAL[opcode as usize];
    if !taken {
        match opcode {
            0xC0 | 0xC8 | 0xD0 | 0xD8 | 0xE0 | 0xE8 | 0xF0 | 0xF8 => cycles = 5,
            0xC2 | 0xCA | 0xD2 | 0xDA | 0xE2 | 0xEA | 0xF2 | 0xFA => cycles = 10,
            0xC4 | 0xCC | 0xD4 | 0xDC | 0xE4 | 0xEC | 0xF4 | 0xFC => cycles = 10,
            0x20 | 0x28 | 0x30 | 0x38 => cycles = 7,
            0x10 => cycles = 8, // DJNZ
            _ => {}
        }
    }
    cycles
}

pub fn get_cb_cycles(opcode: u8) -> u32 {
    let r = opcode & 7;
    let b = (opcode >> 3) & 0x1F;
    if b >= 0x08 && b <= 0x0F { // BIT
        if r == 6 { 12 } else { 8 }
    } else { // RLC, RRC, RL, RR, SLA, SRA, SLL, SRL, RES, SET
        if r == 6 { 15 } else { 8 }
    }
}

pub fn get_ed_cycles(opcode: u8) -> u32 {
    OP_ED[opcode as usize]
}
